<!DOCTYPE html>
<html lang="nl">
<head>
<meta charset="UTF-8">
<title>Level 1 - Pijlenvoorstelling (Controle)</title>
<style>
body { font-family: Arial, sans-serif; text-align: center; padding: 30px; background: #f7f9fc; }
h1 { color: #2c3e50; margin-bottom: 25px; max-width: 500px; margin-left:auto; margin-right:auto; font-size: 20px; }
#LVL101exercise { margin-bottom: 25px; font-size: 20px; }
#LVL101choices { display: grid; grid-template-columns: repeat(2, 400px); gap: 20px; justify-content: center; margin-bottom: 25px; }
.choice { border: 1px solid #ccc; border-radius: 15px; padding: 15px; cursor: pointer; display: flex; flex-direction: column; align-items: center; transition: 0.3s; background: #ffffff; box-shadow: 0 2px 6px rgba(0,0,0,0.1); }
.choice:hover { background-color: #e0f0ff; transform: translateY(-2px); }
.choice.selected { border: 3px solid #007BFF; }
#LVL101feedback { display: none; font-weight: bold; margin-top: 10px; text-align: left; max-width: 500px; margin-left:auto; margin-right:auto; background-color: #fff9e6; padding: 12px 15px; border-radius: 10px; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
svg { width: 360px; height: 60px; }
button { padding: 12px 25px; margin-top: 10px; cursor: pointer; border-radius: 12px; border: none; background-color: #007BFF; color: #fff; font-size: 16px; box-shadow: 0 3px 6px rgba(0,0,0,0.2); transition: 0.2s; }
button:hover:enabled { background-color: #0056b3; transform: translateY(-1px); }
button:disabled { opacity: 0.5; cursor: default; }
#LVL101nextBtn { background-color: #28a745; }
#LVL101nextBtn:hover:enabled { background-color: #1e7e34; }
#LVL101progressContainer { width: 80%; height: 18px; background: #e6e6e6; border-radius: 10px; margin: 20px auto 30px auto; overflow: hidden; box-shadow: inset 0 2px 5px rgba(0,0,0,0.1); }
#LVL101progressBar { height: 100%; width: 0%; background: linear-gradient(90deg, #6ddf4b, #4cc936); transition: width 0.4s ease; }
</style>
</head>
<body>

<h1>Level 1 - Kies de juiste pijlenvoorstelling</h1>
<div id="LVL101exercise"></div>
<div id="LVL101choices"></div>
<button id="LVL101checkBtn" disabled>Controleer</button>
<div class="feedback" id="LVL101feedback"></div>
<button id="LVL101nextBtn" style="display:none;">Volgende oefening</button>

<div id="LVL101progressContainer">
  <div id="LVL101progressBar"></div>
</div>

<script>
const maxLength = 90; 
const centerX = 180; 
const numExercises = 10;
let currentIndex = 0;
let exercises = [];
let xp = 0;

// LocalStorage sleutels
const storageKeyXP = 'level1_xp';
const storageKeyGeslaagd = 'level1_geslaagd';

// Laad eerder opgeslagen XP
if(localStorage.getItem(storageKeyXP)){
  xp = parseInt(localStorage.getItem(storageKeyXP));
}

function updateProgressBar() {
  document.getElementById('LVL101progressBar').style.width = (currentIndex / numExercises * 100) + "%";
}

function generateUniqueExercises(num) {
  const set = new Set();
  const list = [];
  while(list.length < num) {
    const form = Math.floor(Math.random()*6); 
    let a,b,op;
    switch(form){
      case 0: a = rand(1,10); b = rand(1,10); op='+'; break;
      case 1: a = rand(1,10); b = rand(1,a-1); op='-'; break;
      case 2: a = rand(1,10); b = rand(a+1,15); op='-'; break;
      case 3: a = -rand(1,10); b = rand(1,8); op='+'; break;
      case 4: a = -rand(1,5); b = rand(6,10); op='+'; break;
      case 5: a = -rand(1,10); b = rand(1,8); op='-'; break;
    }
    if((op==='-' && a===b)||(op==='+' && a===-b)) continue;
    const key = `${a}${op}${b}`;
    if(!set.has(key)){ set.add(key); list.push({a,b,op}); }
  }
  return list;
}

exercises = generateUniqueExercises(numExercises);
let selectedChoice = null;

function showExercise(){
  updateProgressBar();
  
  const exerciseDiv = document.getElementById('LVL101exercise');
  const choicesDiv = document.getElementById('LVL101choices');
  const fb = document.getElementById('LVL101feedback');
  const checkBtn = document.getElementById('LVL101checkBtn');
  const nextBtn = document.getElementById('LVL101nextBtn');

  if(currentIndex >= exercises.length){
    choicesDiv.innerHTML = '';
    checkBtn.style.display = 'none';
    nextBtn.style.display = 'none';
    fb.style.display = 'none';

    const geslaagd = xp >= 12;
    localStorage.setItem(storageKeyXP, xp);
    localStorage.setItem(storageKeyGeslaagd, geslaagd ? '1' : '0');

    const message = geslaagd 
      ? `<div style="color:#0a7f2e; font-size:18px; margin-top:10px;">
           Goed zo! Je hebt dit onder de knie!<br>Je bent klaar om naar de volgende level te gaan.
         </div>`
      : `<div style="color:#b30000; font-size:18px; margin-top:10px;">
           Dit lukt nog niet zo goed.<br>Je hebt extra stappen nodig om dit doel te bereiken.
         </div>`;

    exerciseDiv.innerHTML = `
      <div style="background:white; padding:25px; border-radius:20px; 
                  box-shadow:0 4px 12px rgba(0,0,0,0.15); max-width:350px; margin: auto;">
         <h2 style="color:#2c3e50;">üéâ Level voltooid! üéâ</h2>
         <div style="font-size:40px; margin:15px 0; color:#f4a300;">‚≠ê ${xp} XP</div>
         ${message}
         <button id="LVL101backBtn" style="margin-top:15px;">Terug naar kaart</button>
      </div>
    `;

    // knop terug naar kaart
    document.getElementById('LVL101backBtn').onclick = () => {
      // Voor iframe situatie
      if(window.completeLevelFromIframe){
        window.completeLevelFromIframe(xp, geslaagd);
      } else {
        // Anders: terug naar hoofdpagina
        window.location.href = 'index.html'; // pas aan naar jouw kaart-pagina
      }
    };
    return;
  }

  const ex = exercises[currentIndex];
  selectedChoice = null;
  exerciseDiv.innerHTML = `<h2>${ex.a} ${ex.op} ${ex.b}</h2>`;
  fb.innerText = ''; fb.style.display = 'none';
  choicesDiv.innerHTML = '';
  checkBtn.disabled = true;
  checkBtn.style.display = 'inline-block';
  nextBtn.style.display = 'none';

  const opts = [
    [{dir:'right',value:ex.a},{dir:'right',value:ex.b}],
    [{dir:'right',value:ex.a},{dir:'left',value:ex.b}],
    [{dir:'right',value:ex.b},{dir:'left',value:ex.a}],
    [{dir:'left',value:ex.b},{dir:'right',value:ex.a}],
    [{dir:'left',value:ex.a},{dir:'right',value:ex.b}],
    [{dir:'left',value:ex.a},{dir:'left',value:ex.b}]
  ];

  let correctIndex;
  if(ex.op==='+' && ex.a>0 && ex.b>0) correctIndex=0;
  else if(ex.op==='-' && ex.a>0 && ex.b>0) correctIndex=1;
  else if(ex.op==='+' && ex.a<0 && ex.b>0) correctIndex=4;
  else if(ex.op==='-' && ex.a<0 && ex.b>0) correctIndex=5;

  opts.forEach((arr, idx)=>{
    const choice = document.createElement('div'); choice.className='choice';
    const svg = document.createElementNS("http://www.w3.org/2000/svg","svg");

    const line = document.createElementNS("http://www.w3.org/2000/svg","line");
    line.setAttribute("x1",0); line.setAttribute("y1",50);
    line.setAttribute("x2",360); line.setAttribute("y2",50);
    line.setAttribute("stroke","black"); line.setAttribute("stroke-width",2);
    svg.appendChild(line);

    const zeroLine = document.createElementNS("http://www.w3.org/2000/svg","line");
    zeroLine.setAttribute("x1",centerX); zeroLine.setAttribute("y1",45);
    zeroLine.setAttribute("x2",centerX); zeroLine.setAttribute("y2",55);
    zeroLine.setAttribute("stroke","black"); zeroLine.setAttribute("stroke-width",2);
    svg.appendChild(zeroLine);

    const zeroText = document.createElementNS("http://www.w3.org/2000/svg","text");
    zeroText.setAttribute("x",centerX-5); zeroText.setAttribute("y",40);
    zeroText.setAttribute("font-size","12"); zeroText.textContent="0";
    svg.appendChild(zeroText);

    const absA = Math.abs(arr[0].value); const absB = Math.abs(arr[1].value);
    const maxAbs = Math.max(absA, absB);
    const firstLength = maxLength * (absA / maxAbs);
    const secondLength = maxLength * (absB / maxAbs);

    const firstX = arr[0].dir==='right'? firstLength : -firstLength;
    const secondX = arr[1].dir==='right'? secondLength : -secondLength;
    const endFirstX = centerX + firstX;
    const endSecondX = endFirstX + secondX;

    drawArrow(svg, centerX,30,endFirstX,30,arr[0].dir==='right'?'blue':'orange');
    drawArrow(svg, endFirstX,10,endSecondX,10,arr[1].dir==='right'?'blue':'orange');

    choice.appendChild(svg);
    choice.onclick = ()=> {
      if(selectedChoice!==null) choicesDiv.children[selectedChoice].classList.remove('selected');
      selectedChoice = idx; choice.classList.add('selected');
      checkBtn.disabled = false;
    };
    choicesDiv.appendChild(choice);
  });

  checkBtn.onclick = ()=>{
    const children = choicesDiv.children;
    const sel = opts[selectedChoice];
    const dir1 = sel[0].dir==='right'?'rechts':'links';
    const dir2 = sel[1].dir==='right'?'rechts':'links';
    const correctDir1 = ex.a>0?'rechts':'links';
    const correctDir2 = (ex.op==='+'? (ex.b>0?'rechts':'links') : (ex.b>0?'links':'rechts'));

    let feedbackText='';
    for(let i=0;i<children.length;i++){ children[i].style.pointerEvents='none'; }

    if(selectedChoice===correctIndex){
      children[selectedChoice].style.backgroundColor='lightgreen';
      fb.innerText='‚úÖ Correct!'; fb.style.display='block';
      xp += (currentIndex < 5)?1:2;
    } else {
      children[selectedChoice].style.backgroundColor='#ffcccc';
      children[correctIndex].style.backgroundColor='lightgreen';
      if(dir1!==correctDir1) feedbackText += `Eerste pijl moet naar ${correctDir1}.<br>`;
      if(dir2!==correctDir2) feedbackText += `Tweede pijl moet naar ${correctDir2}.<br>`;
      fb.innerHTML = feedbackText; fb.style.display='block';
    }

    checkBtn.style.display='none'; nextBtn.style.display='inline-block';
  };

  nextBtn.onclick = ()=>{ currentIndex++; showExercise(); };
}

function drawArrow(svg,x1,y1,x2,y2,color){
  const line = document.createElementNS("http://www.w3.org/2000/svg","line");
  line.setAttribute("x1",x1); line.setAttribute("y1",y1);
  line.setAttribute("x2",x2); line.setAttribute("y2",y2);
  line.setAttribute("stroke",color); line.setAttribute("stroke-width",2); svg.appendChild(line);

  const markerSize = 5;
  const arrow = document.createElementNS("http://www.w3.org/2000/svg","polygon");
  if(x2>x1) arrow.setAttribute("points",`${x2},${y2} ${x2-markerSize},${y2-markerSize/2} ${x2-markerSize},${y2+markerSize/2}`);
  else arrow.setAttribute("points",`${x2},${y2} ${x2+markerSize},${y2-markerSize/2} ${x2+markerSize},${y2+markerSize/2}`);
  arrow.setAttribute("fill",color); svg.appendChild(arrow);
}

function rand(min,max){ return Math.floor(Math.random()*(max-min+1))+min; }

showExercise();
</script>
</body>
</html>

